<!DOCTYPE html>
<html>
<head><title>Popup Test</title></head>
<body>
    <button id="openBtn">Open Grist Login</button>
    <script>
        document.getElementById('openBtn').addEventListener('click', function() {
            const loginUrl = 'https://tiss-auth.fcuai.tw/'; // 你的 Grist URL
            console.log('Button clicked, attempting to open popup...');
            try {
                const newWin = window.open(loginUrl, 'TestPopup', 'width=600,height=400');
                
                if (newWin && !newWin.closed) { // 增加 !newWin.closed 檢查更保險
                    console.log('Popup opened successfully, reference obtained:', newWin);
                    alert('SUCCESS: Got window reference!');
                    // 你可以在這裡嘗試 newWin.focus()
                    // let checkClosedInterval = setInterval(() => {
                    //     if (newWin.closed) {
                    //         console.log('Popup was closed.');
                    //         clearInterval(checkClosedInterval);
                    //     }
                    // }, 500);
                } else {
                    console.error('Failed to open popup or get a valid reference. newWin:', newWin, 'Is newWin.closed?', (newWin ? newWin.closed : 'N/A'));
                    alert('FAILURE: window.open returned ' + (newWin === null ? 'null' : 'a closed window reference') + '. Check browser popup blocker settings and console.');
                }
            } catch (e) {
                console.error('Error during window.open attempt:', e);
                alert('ERROR: An exception occurred during window.open: ' + e.message);
            }
        });
    </script>
</body>
</html>